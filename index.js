console.log("%cWelcome to the Isotopeia console!\nIf you wanna cheat, use the mod in the IsotopeiaMods repo.","font-size:18pt;");let mostRecentVersion="v1.12.4";var elncn=0,elnncn=0,upcn=0,elnpc=1,elnnpc=1,uppc=1,elnps=0,elnnps=0,upps=0,verboseLogging=!0,bch=0,cph=0,lpc=0,ph=0,gl=0,wf=0,wf2=0,cphc=500,lpc=0,timesdone=0,LoggerIso=new Logger(verboseLogging?Levels.VERBOSE:Levels.ERROR,loggingClass="Isotopeia"),ele=document.getElementById("bcham"),ctx=ele.getContext("2d"),tosave=[],toload=[""],hooks=[],runners=[],buildingCounts={},ran=!1,beatenGame=!1,dark=!1,psEach,onloadHooks=[()=>{jtParsed=applyBuildingUpdates()&&combineModBuildings(blankToZero(JSON.parse(localStorage.getItem("jtopia")),[]))},()=>{psEach={e:getPS(jtParsed,"e"),en:getPS(jtParsed,"en"),u:getPS(jtParsed,"u")}}];let unitList=["","thousand","million","billion","trillion","quadrillion","quintillion","sextillion","septillion","octillion","nonillion","decillion","undecillion","duodecillion","tredecellion","quattuordecillion","quindecillion","sexdecillion","septendecillion","octodecillion","novemdecillion","vigintillion","unvigintillion","duovigintillion","trevigintillion","quattuorvigintillion","quinvigintillion","sexvigintillion","septenvigintillion","octovigintillion","nonvigintillion","trigintillion","untringintillion","duotrigintillion","tretrigintillion","quattortrigintillion","quintrigintillion","sextrigintillion","septentrigintillion","octotrigintillion","novemtrigintillion","quadragintillion","unquadragintillion","duoquadragintillion","trequadragintillion","quattuorquadragintillion","quinquadragintillion","sexquadragintillion","septenquadragintillion","octoquadragintillion","novemquadragintillion","quinquagintillion","unquinquagintillion","duoquinquagintillion","trequinquagintillion","quattuorquinquagintillion","quinquinquagintillion","sexquinquagintillion","septquinquagintillion","octoquinquagintillion","novemquinquagintillion","sexagintillion","unsexagintillion","duosexagintillion","tresexagintillion","quattuorsexagintillion","quinsexagintillion","sexsexagintillion","septensexagintillion","octosexagintillion","novemsexagintillion","septuagintillion","unseptuagintillion","duoseptuagintillion","treseptuagintillion","quattuorseptuagintillion","quinseptuagintillion","sexseptuagintillion","septenseptuagintillion","octoseptuagintillion","novemseptuagintillion","octogintillion","unoctogintillion","duooctogintillion","treoctogintillion","quattuoroctogintillion","quinoctogintillion","sexoctogintillion","septenoctogintillion","octooctogintillion","novemoctogintillion","nonagintillion","unnonagintillion","duononagintillion","trenonagintillion","quattuornonagintillion","quinnonagintillion","sexnonagintillion","septennonagintillion","octononagintillion","novemnonagintillion","centillion","uncentillion","duocentillion"],electronn=e=>{elnncn+=e,update()},electron=e=>{elncn+=e,update()},upq=e=>{upcn+=e,update()},blankToZero=(e,n=0)=>[null,void 0,NaN].includes(e)?n:e,getPS=(e,n)=>e.buildings[n].reduce((e,n)=>Object.assign(e,{[n.id]:n.perSecond}),{}),getGainWithCounts=(n,t)=>Object.keys(n).map(e=>blankToZero(n[e])*blankToZero(t[e])).reduce((e,n)=>e+n),jtParsed,getPriciestBuilding=(e,n="en")=>e.buildings[n].sort((e,n)=>n.price-e.price)[0],toUnitName=e=>Math.log10(e)<0?"0":(e/Math.pow(10,3*Math.floor(Math.log10(Math.floor(e))/3))).toFixed(3)+" "+unitList[Math.floor(Math.log10(Math.floor(e))/3)];function save(){localStorage.setItem("ucc",JSON.stringify([elncn,elnncn,upcn])),localStorage.setItem("pc",JSON.stringify([elnpc,elnnpc,uppc])),localStorage.setItem("upg",JSON.stringify(["","",tosave])),localStorage.setItem("beaten_game",JSON.stringify(beatenGame)),localStorage.setItem("dark_mode",JSON.stringify(dark)),localStorage.setItem("counts",JSON.stringify(buildingCounts)),localStorage.setItem("verboseLogging",JSON.stringify(verboseLogging))}let b64Encode=e=>window.btoa(unescape(encodeURIComponent(e))),b64Decode=e=>decodeURIComponent(escape(window.atob(e))),tryOrLog=(e,n,t=Levels.ERROR)=>{"string"==typeof n&&(n=e=>n);try{e()}catch(e){n(e)}};function exportSave(){return b64Encode(JSON.stringify([[elncn,elnncn,upcn],[cph,lpc,tosave],[],localStorage.getItem("prestige"),localStorage.getItem("counts"),localStorage.getItem("verboseLogging"),localStorage.getItem("pc")]))}function importSave(e){e=JSON.parse(b64Decode(e));localStorage.setItem("ucc",e[0]),localStorage.setItem("upg",e[1]),localStorage.setItem("prestige",e[3].toLocaleString("fullwide",{useGrouping:!1})),localStorage.setItem("counts",e[4]),localStorage.setItem("verboseLogging",e[5]),localStorage.setItem("pc",e[6]),buildingCounts=e[4],prestigeLevel=parseInt(e[3]),verboseLogging=JSON.parse(e[5]),tryOrLog(load,"B64 load error!"),update()}function load(){var ucc=JSON.parse(localStorage.getItem("ucc")),upg=JSON.parse(localStorage.getItem("upg")),bcs=JSON.parse(localStorage.getItem("counts")),verboseLogging=JSON.parse(localStorage.getItem("verboseLogging")),pc=JSON.parse(localStorage.getItem("pc"));beatenGame=JSON.parse(localStorage.getItem("beaten_game")),dark=JSON.parse(localStorage.getItem("dark_mode")),dark?document.body.classList.add("dark"):document.body.classList.remove("dark"),elncn=blankToZero(ucc[0]),elnncn=blankToZero(ucc[1]),upcn=blankToZero(ucc[2]),ph=ucc[3],gl=ucc[4],wf=ucc[5],wf2=ucc[6],cph=upg[0],elnpc=pc[0],elnnpc=pc[1],uppc=pc[2],buildingCounts=null!=bcs?bcs:{},tryOrLog(()=>{toload=JSON.parse(localStorage.getItem("tl"))[0];for(var i=1;i<toload.length;i++)tryOrLog(()=>{var tlR=eval(toload[i]);tlR.buildUI(),tlR.refreshCount()},e.message)},e=>"toload error: "+e.message),hooks=parseToJs(localStorage.getItem("jtopia")),addItems(),ran=!0,update()}function updatePerSecond(){elnps=getGainWithCounts(psEach.e,buildingCounts)*(1+prestigeLevel),elnnps=getGainWithCounts(psEach.en,buildingCounts)*(1+prestigeLevel),upps=getGainWithCounts(psEach.u,buildingCounts)*(1+prestigeLevel),elnpc=1+Math.floor(elnps/15),elnnpc=1+Math.floor(elnnps/15),uppc=1+Math.floor(upps/15)}function update(){document.getElementById("elnncnt").innerHTML=toUnitName(elnncn),document.getElementById("elncnt").innerHTML=toUnitName(elncn),document.getElementById("upqcnt").innerHTML=toUnitName(upcn);for(var e=0;e<runners.length;e++)runners[e]();2<=elnncn&&document.getElementById("adde").removeAttribute("disabled"),5<=elncn&&document.getElementById("addup").removeAttribute("disabled"),500<=prestigeLevel&&!beatenGame&&setTimeout(()=>{document.querySelectorAll(".game").forEach(e=>e.style.display="none"),document.body.style.backgroundColor="black",document.querySelectorAll(".end").forEach(e=>e.style.display="block")},200),updatePerSecond(),document.getElementById("prestigeButton").innerHTML=`Prestige for ${toUnitName(prestigeCalc(elncn,elnncn,upcn))} positrons`}function addItems(){for(var e=0;e<hooks.length;e++)hooks[e].buildUI();update()}window.onload=()=>{beatenGame="true"==localStorage.getItem("beaten_game");var to,x=0,warnings=0;if(migrationProcessor(localStorage.getItem("version")),document.getElementById("titleHTML").innerHTML="Isotopeia - "+mostRecentVersion,onloadHooks.forEach(e=>e()),!ran){var ucc=JSON.parse(localStorage.getItem("ucc"));elncn=blankToZero(ucc[0]),elnncn=blankToZero(ucc[1]),upcn=blankToZero(ucc[2]),tryOrLog(()=>{var tmp=[];toload=JSON.parse(localStorage.getItem("tl"))[0];for(var i=0;i<toload.length;i++)try{eval(toload[i+1]).interval(),tmp.push(eval(toload[i+1]).name)}catch{warnings++}let unique=[...new Set(tmp)];for(var n=0;n<tmp.length;n++)eval(toload[tmp.lastIndexOf(unique[n])]).buildUI()},"weird error in onload !ran loop, this is probably fine",Levels.VERBOSE);let nextonlyUnparsed=localStorage.getItem("nextonly");nextonlyUnparsed=blankToZero(nextonlyUnparsed)?nextonlyUnparsed:"[]",JSON.parse(nextonlyUnparsed).forEach(e=>eval(e)),localStorage.setItem("nextonly","[]"),load(),addItems()}LoggerIso.logInfo(warnings+" error(s) in try/catch during window.onload, almost certainly fine"),null===elnncn&&(elnncn=0),uniqueItems.forEach(e=>e.refreshIntervals()),update()};var actuallySave=!0;let confirmReset=()=>{document.getElementById("resetcheckbox").checked&&resetNoconfirm()};function resetNoconfirm(){actuallySave=!1,localStorage.setItem("ucc",JSON.stringify([0,0,0])),localStorage.setItem("upg",JSON.stringify([0,0,[]])),localStorage.setItem("cst",JSON.stringify([0,0])),localStorage.setItem("tl",'[[""]]'),localStorage.setItem("jtopia",stockBuildingsJsonStr),localStorage.setItem("prestige","0"),localStorage.setItem("counts","{}"),localStorage.setItem("version","v1.12.1"),LoggerIso.logWarn("Resetting! This is irreversible without a save backup in Base64."),location.reload()}function migrationProcessor(e){if(null==e)LoggerIso.logWarn("Migrating from pre-v1.10.0 (resetting!)"),LoggerIso.logWarn("Here's your save as backup:"),console.log(exportSave()),resetNoconfirm();else if(localStorage.setItem("version",mostRecentVersion),buildingUpdateNeeded())return localStorage.setItem("jtopia",stockBuildingsJsonStr),location.reload()}function combineModBuildings(n){if(n.length<=1)return n[0];var e=n.map(e=>e.buildings);let o={buildings:{en:[],e:[],u:[]},customBehaviors:""};return Object.keys(e[0]).forEach(t=>{var e=n.reduce((e,n)=>[...e.buildings[t],...n.buildings[t]]);o.buildings[t]=o.buildings[t].concat(e.buildings[t])}),o}function buildingUpdateNeeded(){if(null===localStorage.getItem("jtopia"))return!0;var e=JSON.parse(stockBuildingsJsonStr)[0],n=JSON.parse(localStorage.getItem("jtopia"))[0];const t=getPriciestBuilding(e,"en"),o=getPriciestBuilding(e,"e"),i=getPriciestBuilding(e,"u"),l=getPriciestBuilding(n,"en"),a=getPriciestBuilding(n,"e"),r=getPriciestBuilding(n,"u");return t.id!=l.id||o.id!=a.id||i.id!=r.id}function applyBuildingUpdates(){return buildingUpdateNeeded()&&localStorage.setItem("jtopia",stockBuildingsJsonStr),!0}window.onbeforeunload=()=>{actuallySave&&save()};